<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Quản Lý Môn Học</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="bg-light">
    <div class="container py-5">
        <div class="card shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h4 class="text-primary mb-0">DANH MỤC MÔN HỌC</h4>
                <button class="btn btn-primary" onclick="showAddModal()">+ Thêm Môn Học</button>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-hover">
                    <thead class="table-dark text-center">
                        <tr>
                            <th>ID</th>
                            <th>Tên Môn Học</th>
                            <th>Số Tín Chỉ</th>
                            <th>Thao Tác</th>
                        </tr>
                    </thead>
                    <tbody id="monHocTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalMonHoc" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Thông Tin Môn Học</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="idMonHoc">
                    <div class="mb-3">
                        <label class="form-label">Tên Môn Học</label>
                        <input type="text" id="tenMon" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Số Tín Chỉ</label>
                        <input type="number" id="soTinChi" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnSave" class="btn btn-success w-100">Lưu Dữ Liệu</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            loadMonHoc();

            function loadMonHoc() {
                $.post("mon_hoc_api.php", { action: "fetch" }, function (data) {
                    let rows = "";
                    $.each(JSON.parse(data), function (i, v) {
                        rows += `<tr>
                            <td class="text-center">${v.id}</td>
                            <td>${v.ten_mon}</td>
                            <td class="text-center">${v.so_tin_chi}</td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-warning btnEdit" data-id="${v.id}" data-ten="${v.ten_mon}" data-stc="${v.so_tin_chi}">Sửa</button>
                                <button class="btn btn-sm btn-danger btnDelete" data-id="${v.id}">Xóa</button>
                            </td>
                        </tr>`;
                    });
                    $("#monHocTable").html(rows);
                });
            }

            $("#btnSave").click(function () {
                let id = $("#idMonHoc").val();
                let action = id ? "update" : "insert";
                $.post("mon_hoc_api.php", {
                    action: action, id: id,
                    ten_mon: $("#tenMon").val(),
                    so_tin_chi: $("#soTinChi").val()
                }, function () {
                    $("#modalMonHoc").modal("hide");
                    loadMonHoc();
                });
            });

            $(document).on("click", ".btnEdit", function () {
                $("#idMonHoc").val($(this).data("id"));
                $("#tenMon").val($(this).data("ten"));
                $("#soTinChi").val($(this).data("stc"));
                $("#modalMonHoc").modal("show");
            });

            $(document).on("click", ".btnDelete", function () {
                if (confirm("Xóa môn học này?")) {
                    $.post("mon_hoc_api.php", { action: "delete", id: $(this).data("id") }, function () {
                        loadMonHoc();
                    });
                }
            });
        });

        function showAddModal() {
            $("#idMonHoc").val(""); $("#tenMon").val(""); $("#soTinChi").val("");
            $("#modalMonHoc").modal("show");
        }
    </script>
</body>

</html>